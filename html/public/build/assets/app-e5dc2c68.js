const s={add:function(){let t={name:$("#project-name").val(),_token:$('input[name="_token"').val()};$.post("/api/projects",t,function(e){if(e.error)$("#project-error").html(e.error.join(", "));else{$("#project-name").val(""),$("#project-error").html("");let a=$("#project-template").clone();$(a).find(".list-item").html(e.name),$("li",a).addClass("project-"+e.id).attr("data-id",e.id),$("#project-list").append($(a).html()),$("#projects").append($("<option>",{value:e.id,text:e.name})),$(".project .delete").on("click",s.delete)}})},delete:function(){let t=$(this).closest("li").data("id");$.ajax({url:"/api/projects/"+t,type:"DELETE",success:function(){$(".project-"+t).remove(),$("#projects").val()==t&&$("#projects").val("").trigger("change"),$('#projects option[value="'+t+'"]').remove()}})}},i={list:function(){let t=$("#projects").val(),e=t?$("#projects option:selected").text():"";$("#project").html(e),$("#task-list").html(""),t&&$.get("/api/projects/"+t,{},function(a){$.each(a,function(){let l=$("#task-template").clone();$(l).find(".list-item").html(this.name),$("li",l).addClass("task-"+this.id).attr("data-id",this.id),$("#task-list").append($(l).html())}),$(".edit").on("click",i.edit),$(".task .delete").on("click",i.delete)})},add:function(){let t={project_id:$("#projects").val(),name:$("#task-name").val(),order:$("#task-list li").length+1,_token:$('input[name="_token"').val()};$.post("/api/tasks",t,function(e){if(e.error)$("#task-error").html(e.error.join(", "));else{$("#task-name").val(""),$("#task-error").html("");let a=$("#task-template").clone();$(a).find(".list-item").html(e.name),$("li",a).addClass("task task-"+e.id).attr("data-id",e.id),$("#task-list").append($(a).html()),$(".edit").on("click",i.edit),$(".task .delete").on("click",i.delete)}})},edit:function(){let t=$(this).closest("li").data("id"),e=$(this).closest("li").find(".list-item").html(),a=prompt("Enter new task name",e);if(a){let l={project_id:$("#projects").val(),name:a};$.ajax({url:"/api/tasks/"+t,type:"PUT",data:l,success:function(o){o.success?$(".task-"+t+" .list-item").html(a):alert(o.error.join("<br/>"))}})}},delete:function(){let t=$(this).closest("li").data("id");$.ajax({url:"/api/tasks/"+t,type:"DELETE",success:function(){$(".task-"+t).remove()}})},sort:function(t,e){let a={},l=1;$("#task-list").children().each(function(){a[l++]=$(this).data("id")}),$.ajax({url:"/api/tasks/sort",type:"PUT",data:{tasks:a}})}};$(function(){$("#project-name").on("keypress",function(t){t.which==13&&s.add()}),$("#add-project").on("click",s.add),$(".project .delete").on("click",s.delete),$("#projects").on("change",i.list),$("#task-name").on("keypress",function(t){t.which==13&&i.add()}),$("#add-task").on("click",i.add),$("#task-list").sortable({stop:i.sort})});
